<!DOCTYPE html>
<html lang="pt-br">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Calculadora JJM</title>

   <style>
      body {
         font-family: Arial, sans-serif;
         background-color: #1E90FF;
         min-height:300vh;
         margin: 0;
         padding: 0;
         overflow: hidden;
      }

      /* --- CALCULADORA --- */
      .calculator {
         position: fixed;
   display: flex;
   flex-direction: column;
   resize: none; /* continua usando o seu handle personalizado */
         width: 20%;
         min-width: 150px;
   height: auto; /* mas pode crescer */
   min-height: 370px; 
         top: 15vh;
         left: 10vw;         
    background-color: silver;
    border: 0.2vh solid red;
    border-radius: 2vh;
    box-shadow: 0 2vh 4vh rgba(0, 0, 0, 0.6);
       padding: 1%;
       z-index: 2000;
      }

      /* --- HEADER / ÁREA DE ARRASTAR --- */
      .header {
         color: #fff;
         display: flex;
         justify-content: space-between;
         align-items: center;

         font-size: 2vh;
         margin-bottom: 1vh;
         padding: 1vh;
         background-color: #2c363d;
         border-radius: 1vh;
         cursor: move;
         user-select: none;
      }

      /* --- VISOR --- */
      #numero {
         width: 100%;
      height: 10vh;      /* altura fixa proporcional */
   font-size: 7vh;    /* texto grande e responsivo */
         margin-bottom: 1vh;
         padding: 1vh;
         text-align: right;
         border: 1px solid indigo;
         border-radius: 1vh;
         background-color: #2cff05;
         color: #2323ff;
         outline: none;
         box-sizing: border-box;
      }

      /* GRADE DE BOTÕES */
      .buttons {
      height: calc(100% - 12vh - 2vh); /* 12vh do visor, 2vh de margens */
   display: grid;
   grid-template-columns: repeat(4, 1fr);
   grid-auto-rows: 1fr;  /* Faz as linhas crescerem uniformemente */
   gap: 1vh;
      }

      .buttons button {
       width: 100%;
   height: 100%;
   padding: 0;
   margin: 0;
   font-size: 3vh; /* aumenta junto com o tamanho dos botões */
       /*  padding: 1vh;*/
         border-radius: 1vh;
       /*  font-size: 4vh;*/
         font-family: Verdana;
         box-shadow: rgba(45, 35, 66, .4) 0 2px 4px,
                     rgba(45, 35, 66, .3) 0 7px 13px -3px,
                     rgba(58, 65, 111, .5) 0 -3px 0 inset;
      }

      .buttons button:hover {
         transform: scale(1.04);
         background-color: #D2691E;
         color: #fff;
      }

      .buttons button:active {
         transform: scale(0.97);
         box-shadow: inset 0 0 7px rgba(0,0,0,.2);
      }

      .number { background-color: skyblue; }
      .operator { background-color: #ff9500; }
      .clear { background-color: #ff3b30; }
      .equals {
         background-color: #34c759;
         grid-column: span 2;
      }

      /* --- HANDLE DE REDIMENSIONAMENTO --- */
      .resize-handle {
         position: absolute;
         width: 2.5vh;
         height: 2.5vh;
         right: 0;
         bottom: 0;
         cursor: se-resize;
      }

      .resize-handle::after {
         content: "";
         position: absolute;
         right: 0;
         bottom: 0;
         width: 100%;
         height: 100%;
         border-right: 0.6vh solid #333;
         border-bottom: 0.6vh solid #333;
         box-sizing: border-box;
      }

      /* --- RESPONSIVIDADE --- */
      @media (max-width: 768px) {
         .calculator {
            width: 85%;
         }

         #numero {
            height: 12vh;
            font-size: 7vh;
         }

         .buttons button {
            height: 8vh;
         }
      }
   </style>
</head>

<body>

   <div class="calculator" id="draggableCalculator">
      
      <div class="header" id="dragHeader">
         <span style="margin-left: 1vh;">JJM</span>
      </div>

      <input type="text" id="numero" disabled placeholder="0">

      <div class="buttons">
         <button class="clear" onclick="clearDisplay()">C</button>
         <button class="operator" onclick="calculateRootN()">ⁿ√</button>
         <button class="operator" onclick="appendValue('**')">xⁿ</button>
         <button class="operator" onclick="appendValue('/')">÷</button>

         <button class="number" onclick="appendValue('7')">7</button>
         <button class="number" onclick="appendValue('8')">8</button>
         <button class="number" onclick="appendValue('9')">9</button>
         <button class="operator" onclick="appendValue('*')">x</button>

         <button class="number" onclick="appendValue('4')">4</button>
         <button class="number" onclick="appendValue('5')">5</button>
         <button class="number" onclick="appendValue('6')">6</button>
         <button class="operator" onclick="appendValue('-')">-</button>

         <button class="number" onclick="appendValue('1')">1</button>
         <button class="number" onclick="appendValue('2')">2</button>
         <button class="number" onclick="appendValue('3')">3</button>
         <button class="operator" onclick="appendValue('+')">+</button>

         <button class="number" onclick="appendValue('0')">0</button>
         <button class="number" onclick="appendValue('.')">.</button>
         <button class="equals" onclick="calculateResult()">=</button>
      </div>

      <!-- Handle de redimensionamento -->
      <div class="resize-handle"></div>

   </div>

   <script>
      const visor = document.getElementById('numero');
      const calculator = document.getElementById('draggableCalculator');
      const dragHeader = document.getElementById('dragHeader');
      const resizeHandle = document.querySelector(".resize-handle");

      // ---------------- CALCULADORA -----------------

      function calculateRootN() {
         appendValue('**(1/');
      }

      function appendValue(value) {
         if (visor.value === 'Erro' || visor.value === 'Infinity') {
            visor.value = '';
         }

         if (visor.value === '0' && !isNaN(value) && value !== '.') {
            visor.value = value;
         } else if (value === '**' && visor.value.endsWith('**')) {
            return;
         } else {
            visor.value += value;
         }
      }

      function clearDisplay() {
         visor.value = '0';
      }

      function calculateResult() {
         try {
            let expression = visor.value;

            if ((expression.match(/\(/g) || []).length > (expression.match(/\)/g) || []).length) {
               expression += ')';
            }

            let result = eval(expression);

            if (!isFinite(result)) {
               visor.value = "Erro";
            } else {
               visor.value = Number.isInteger(result)
                  ? result
                  : result.toFixed(2).replace(/\.?0+$/, "");
            }

         } catch (e) {
            visor.value = 'Erro';
         }
      }

      clearDisplay();

      // ---------------- ARRASTAR -----------------

      let isDragging = false;
      let offset = { x: 0, y: 0 };

      dragHeader.addEventListener('mousedown', function (e) {
          isDragging = true;
          const rect = calculator.getBoundingClientRect();
          offset.x = e.clientX - rect.left;
          offset.y = e.clientY - rect.top;
      });

      document.addEventListener('mousemove', function (e) {
          if (!isDragging) return;

          let newX = e.clientX - offset.x;
          let newY = e.clientY - offset.y;

          const maxX = window.innerWidth - calculator.offsetWidth;
          const maxY = window.innerHeight - calculator.offsetHeight;

          if (newX < 0) newX = 0;
          if (newX > maxX) newX = maxX;

          if (newY < 0) newY = 0;
          if (newY > maxY) newY = maxY;

          calculator.style.left = newX + "px";
          calculator.style.top = newY + "px";
      });

      document.addEventListener('mouseup', function () {
          isDragging = false;
          isResizing = false;
      });

      // ---------------- REDIMENSIONAR -----------------

      let isResizing = false;

      resizeHandle.addEventListener("mousedown", function (e) {
         e.preventDefault();
         isResizing = true;
      });

      document.addEventListener("mousemove", function (e) {
         if (!isResizing) return;

         let newWidth = e.clientX - calculator.getBoundingClientRect().left;
         let newHeight = e.clientY - calculator.getBoundingClientRect().top;

         const minWidth = 150;
         const minHeight = 250;

         if (newWidth > minWidth) calculator.style.width = newWidth + "px";
         if (newHeight > minHeight) calculator.style.height = newHeight + "px";
      });
   </script>

</body>
</html>